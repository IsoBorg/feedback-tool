<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Feedback Tool Web App</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:20px}
    h1,h2{margin-bottom:10px}
    table{border-collapse:collapse;width:100%;margin-bottom:20px}
    th,td{border:1px solid #ccc;padding:6px;vertical-align:top}
    th{background:#f4f4f4}
    input[type="number"],input[type="text"]{padding:5px;width:100%;box-sizing:border-box}
    button{padding:6px 12px;margin-top:5px;cursor:pointer}
    .output{margin-top:10px;white-space:pre-wrap;background:#f9f9f9;padding:10px;border-radius:4px}
    .missed{background:#ffe6e6}
    .section{margin-bottom:30px}
    label{display:inline-block;margin-right:10px}
  </style>
</head>
<body>
  <h1>Feedback Tool</h1>

  <!-- Вопросы и баллы -->
  <div class="section">
    <h2>Вопросы и баллы</h2>
    <table id="questionsTable">
      <thead><tr><th>#</th><th>Вопрос</th><th>Макс. балл</th></tr></thead>
      <tbody></tbody>
    </table>

    <label>Баллы (C34):
      <input type="number" id="totalScore" min="0" max="69" value="0">
    </label>
    <button id="btnCompute">Обновить пропущенные</button>
    <div id="missedList" class="output">Ничего не пропущено</div>
  </div>

  <!-- Итоговая оценка -->
  <div class="section">
    <h2>Балловая оценка</h2>
    <div>Процент: <span id="percentScore">0%</span></div>
    <div>Оценка без выполнения по в/о: <span id="scoreNoTarget">0</span></div>
    <div>С выполненной целью по в/о: <span id="scoreWithTarget">0</span></div>
  </div>

  <!-- Время обслуживания -->
  <div class="section">
    <h2>Время обслуживания</h2>
    <button id="btnGenerateTimes">Сгенерировать время</button>
    <div id="timesOutput" class="output"></div>
  </div>

  <!-- Обратная связь -->
  <div class="section">
    <h2>Обратная связь</h2>
    <button id="btnGenerateFeedback">Сгенерировать обратную связь</button>
    <div id="feedbackOutput" class="output"></div>
  </div>

<script>
/* ----------- 32 вопроса ----------- */
const questions=[ /* <-- тот же массив, сокращён здесь ради места */
  {q:1,text:"Лидер участка готовится к смене, заполняет чек-лист подготовки; собирает и анализирует ключевую информацию.",max:3},
  {q:2,text:"Проверяет расписание и убеждается в достаточном количестве сотрудников и правильной комплектации позиций.",max:3},
  {q:3,text:"Контролирует запас упаковки на 24 ч и продуктов на 2 ч; участок организован эргономично.",max:2},
  {q:4,text:"Проверяет работу и настройку оборудования, наличие мелкого инвентаря, график включения/выключения.",max:2},
  {q:5,text:"Формулирует цели смены, доводит их до команды, фокусируется на устранении корневых причин проблем.",max:2},
  {q:6,text:"Проверяет работоспособность всех опций сервиса (мобильный заказ, киоски, ORV и др.).",max:1},
  {q:7,text:"Соблюдаются первичные и вторичные сроки хранения; продукты промаркированы.",max:3},
  {q:8,text:"Мойка рук и правила личной гигиены соблюдаются; больные сотрудники не допускаются к работе.",max:2},
  {q:9,text:"Правильное использование перчаток, сеточек, СИЗ; санитарная одежда применяется по инструкции.",max:1},
  {q:10,text:"Готовая продукция соответствует Золотым стандартам качества.",max:3},
  {q:11,text:"Лидер оценивает качество картофеля, напитков и десертов, умеет распознавать отклонения.",max:2},
  {q:12,text:"Опасные зоны выявляются и устраняются; применяется алгоритм «step in/step out».",max:3},
  {q:13,text:"Расстановка персонала соответствует VLH, контроль выходов/перерывов ведётся.",max:5},
  {q:14,text:"К пиковым часам готовятся заранее; станции укомплектованы по системе 24/2.",max:3},
  {q:15,text:"Заказы готовятся по мониторам и своевременно удаляются.",max:2},
  {q:16,text:"Сбор заказов организован: информация вовремя, сборщик не останавливается, экспедитор на месте.",max:3},
  {q:17,text:"Соблюдаются процедуры сброса заказов на KVS, презентере, окне Экспресс.",max:3},
  {q:18,text:"Работники уверенно принимают и продают заказы, применяя принцип «Выгодный Комбо+1».",max:3},
  {q:19,text:"Заказы без бургеров обслуживаются вне очереди, невостребованные обрабатываются корректно.",max:2},
  {q:20,text:"Общение с гостями вежливое и индивидуальное; выполняются 4 шага возврата гостей.",max:2},
  {q:21,text:"Контроль качества на станциях, своевременное удаление невостребованной продукции.",max:2},
  {q:22,text:"Лидер эффективно решает жалобы и знает порядок действий при сбоях приложения.",max:2},
  {q:23,text:"Точность выдачи заказов высокая; при ≥2 жалобах баллы не начисляются.",max:5},
  {q:24,text:"Пункт без баллов (0).",max:0},
  {q:25,text:"Обслуживание за столами аккуратное; гости получают приборы и салфетки.",max:1},
  {q:26,text:"Доставка собирается/выдаётся по стандарту; при ≥10 заказах/ч комплектация переносится.",max:1},
  {q:27,text:"Соблюдаются стандарты внешнего вида персонала.",max:1},
  {q:28,text:"Принцип «ЧПХРР» выполняется; видимые гостям зоны чистые.",max:1},
  {q:29,text:"Лидер наставляет и мотивирует работников, проводит мини-соревнования.",max:1},
  {q:30,text:"В течение смены анализирует скорость обслуживания и отзывы гостей, корректирует процессы.",max:1},
  {q:31,text:"Ведёт учёт отходов и выполняет план сокращения потерь.",max:1},
  {q:32,text:"Анализирует результаты смены, отмечает достижения, благодарит команду.",max:1}
];

/* -------- 28 шаблонов без упоминания пунктов -------- */
const feedbackTemplates=[
{good:1,bad:4,text:"Ты идеально организуешь подготовку к смене: чек-лист заполнен вовремя, и ты собираешь всю необходимую информацию. Обращай внимание на наличие чистого мелкого инвентаря и продукции по принципу 24/2 на каждой станции, чтобы во время пиковой нагрузки процессы не останавливались."},
  {good:2,bad:22,text:"Расписание и комплектация персонала у тебя под контролем: все позиции закрыты, и команда расставлена по VLH. Давай больше обратной связи сотрудникам по процедурам и чаще ходи в обходы, чтобы усилить стандарты внешнего вида и мотивацию."},
  {good:7,bad:3,text:"Запасы продуктов маркированы и сроки хранения соблюдены, но оптимизируй оформление рабочего пространства: оптимальная организация ускорит обслуживание гостей и снизит риск ошибок при сборе заказа."},
  {good:4,bad:12,text:"Молодец, что ты контролируешь работу оборудования и следишь за выполнением заданий ПТО. Внимательнее отслеживай график включения и выключения техники и практикуй алгоритм «step in/step out» во время смены."},
  {good:5,bad:6,text:"Цели смены сформулированы и доведены до команды. Активнее проводи обходы и давай развивающую обратную связь, чтобы сотрудники понимали, как улучшать навыки."},
  {good:8,bad:9,text:"Личная гигиена сотрудников на высоком уровне: мойка рук и правила личной гигиены соблюдаются; больные сотрудники не допускаются к работе. Обрати внимание на своевременную замену санитарной одежды."},
  {good:10,bad:11,text:"Готовая продукция соответствует стандартам качества. Добавь проверку продукции перед пиковыми часами, чтобы вовремя замечать и корректировать отклонения."},
  {good:11,bad:13,text:"Ты регулярно оцениваешь внешний вид картофеля, напитков и десертов и распознаёшь отклонения. Обращай больше внимания на опасные зоны и отрабатывай процесс «step in/step out» на смене"},
  {good:12,bad:14,text:"Ты быстро устраняешь потенциальные опасные зоны с помощью алгоритма «step in/step out». Проследи, чтобы сотрудники строго стояли по таблицуе VLH и своевременно отгуливай все перерывы"},
  {good:13,bad:15,text:"Персонал расставлен согласно VLH. Убедись, что все готовы к пиковым часам и соблюдаюются процедуры сброса заказов с монитора, чтобы не возникло узких мест."},
  {good:14,bad:16,text:"К пиковым часам готовишься заранее, станции укомплектованы по системе 24/2. Следи процедурами работы с мониторами, для соблюдения стандартов обслуживания и впечатляющего обслуживания гостей."},
  {good:15,bad:17,text:"Заказы удаляются с мониторов без задержек, сборщик видит актуальную информацию. Убедись, что экспедитор не отвлекается на второстепенные задачи и остаётся на позиции в часы пик."},
  {good:16,bad:18,text:"Сбор заказов организован чётко. Уделяй внимание своевременному сбросу заказов на KVS-мониторах και окне Экспресс, чтобы соблюдать цели по в/о."},
  {good:18,bad:20,text:"Приём и оплата заказов проходят без ошибок, команда уверенно применяет принцип «Выгодный Комбо+1». Контролируй, чтобы заказы без бургеров обслуживались вне очереди и невостребованные заказы утилизировались правильно."},
  {good:19,bad:21,text:"Заказы без бургеров собираются вне очереди. Удели внимание общению с гостями — индивидуальный подход делает каждый визит приятнее."},
  {good:20,bad:22,text:"Ты общаешься с гостями дружелюбно. Усиль контроль своевременного удаления невостребованной продукции со стола ОАТ и тележки BLZ."},
  {good:21,bad:23,text:"Процедуры на станциях выполняются правильно, ККЧ. Обучи команду действиям при сбоях приложения, чтобы все знали, как действовать."},
  {good:22,bad:25,text:"Ты показываешь пример в решении жалоб и работе при сбоях приложения. Обрати внимание на двойную проверку при выдаче заказов, чтобы исключить ошибки."},
  {good:23,bad:26,text:"Заказы выдаются точно, сборщики проверяют каждый чек. Обрати внимание на обслуживание за столами, чтобы работнкии проверяли наличие приправ и салфеток перед уходом."},
  {good:25,bad:27,text:"Обслуживание за столами аккуратное и дружелюбное. В пиковые часы назначай координатора доставки и следи за организацией зоны, чтобы не было задержек."},
  {good:26,bad:28,text:"Доставка собирается и упаковывается по стандарту. Усиль контроль за внешним видом сотрудников — форма должна быть опрятной, бейджи на месте."},
  {good:27,bad:29,text:"Внешний вид сотрудников всегда опрятен. Обрати внимание на принцип ЧПХР, чтобы поддерживать идеальную чистоту."},
  {good:28,bad:30,text:"Принцип «Чисти по ходу работы» выполняется, зоны обслуживания чистые. Мотивируй команду мини-соревнованиями, чтобы сохранить вовлечённость и ответственность."},
  {good:29,bad:31,text:"Ты наставляешь и мотивируешь команду, проводишь мини-соревнования. Проводите анализ скорости обслуживания ежечасно, чтобы успеть повлиять на ситуацию."},
  {good:30,bad:32,text:"Скорость обслуживания и отзывы гостей анализируются вовремя. Убедись, что учёт отходов ведётся своевременно, чтобы избежать лишних потерь."},
  {good:31,bad:1,text:"Учёт отходов налажен и план по сокращению потерь выполняется. Благодари сотрудников за конкретные достижения, чтобы каждый видел свой вклад."},
  {good:32,bad:2,text:"Ты анализируешь результаты смены и благодаришь команду. Обращай внимание на наличие чистого мелкого инвентаря и запасов по системе 24/2, чтобы во время пиковых часов мы были готовы."}
];

/* ----- генерация таблицы ----- */
const tbody=document.querySelector('#questionsTable tbody');
questions.forEach(q=>{
  const r=tbody.insertRow();
  r.insertCell().textContent=q.q;
  r.insertCell().textContent=q.text;
  r.insertCell().textContent=q.max;
});

/* ----- обработчики ----- */
document.getElementById('btnCompute').addEventListener('click',computeMissed);
document.getElementById('totalScore').addEventListener('change',computeMissed);
document.getElementById('btnGenerateTimes').addEventListener('click',generateTimes);
document.getElementById('btnGenerateFeedback').addEventListener('click',generateFeedback);

/* ----- функции ----- */
function computeMissed(){
  const score=+document.getElementById('totalScore').value||0;
  let missing=69-score-2;                         // -2 за пункт 24
  const missed=[];
  Array.from(tbody.rows).forEach(r=>r.classList.remove('missed'));

  if(missing>0){
    let pool=questions.filter(q=>q.max>0&&q.q!==24);
    for(let i=pool.length-1;i>0;i--){             // перемешиваем
      const j=Math.floor(Math.random()*(i+1));
      [pool[i],pool[j]]=[pool[j],pool[i]];
    }
    for(const item of pool){
      if(item.max<=missing){
        missed.push(item.q);
        missing-=item.max;
      }
      if(missing===0) break;
    }
    if(missing>0){                               // добираем, если нужно
      const extra=pool.find(x=>!missed.includes(x.q));
      if(extra) missed.push(extra.q);
    }
  }
  missed.forEach(n=>tbody.rows[n-1]?.classList.add('missed'));
  document.getElementById('missedList').textContent=
    missed.length?`Пункты не выполняются: ${missed.join(', ')}`:'Ничего не пропущено';
  window._missed=missed;
  updateScores();
}

function updateScores(){
  const score=+document.getElementById('totalScore').value||0;
  const pct=((score/69)*100).toFixed(2)+'%';
  document.getElementById('percentScore').textContent=pct;
  const noTarget=((score/69)*100*0.9).toFixed(2);
  document.getElementById('scoreNoTarget').textContent=noTarget;
  document.getElementById('scoreWithTarget').textContent=(+noTarget+10).toFixed(2);
}

function generateTimes(){
  const ranges=[[80,100,20],[120,200,60],[200,300,20]];
  const F=[],G=[];
  for(let i=0;i<8;i++){
    [F,G].forEach(arr=>{
      const rnd=Math.random()*100;
      let range=ranges.find(r=>rnd<=r[2]||(r[2]===60&&rnd>20))||ranges[1];
      let v=Math.floor(Math.random()*(range[1]-range[0]+1)+range[0]);
      if(v%10===0) v+=Math.floor(Math.random()*7)-3;
      arr.push(v);
    });
  }
  const avg=a=>(()=>a.reduce((s,x)=>s+x,0)/a.length)().toFixed(2);
  document.getElementById('timesOutput').textContent=
    `Прилавок: ${F.join(', ')} — среднее ${avg(F)}\n`+
    `Окно Экспресс: ${G.join(', ')} — среднее ${avg(G)}`;
}

function generateFeedback(){
  const missed=window._missed||[];
  const correct=questions.map(q=>q.q).filter(n=>n!==24&&!missed.includes(n));
  const cands=feedbackTemplates.filter(t=>correct.includes(t.good)&&missed.includes(t.bad));
  const txt=cands.length
    ?cands[Math.floor(Math.random()*cands.length)].text
    :'Нет подходящего шаблона обратной связи.';
  document.getElementById('feedbackOutput').textContent=txt;
}
</script>
</body>
</html>
