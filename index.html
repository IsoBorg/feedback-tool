<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Feedback Tool Web App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1, h2 { margin-bottom: 10px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px; vertical-align: top; }
    th { background: #f4f4f4; }
    input[type="number"], input[type="text"] { padding: 5px; width: 100%; box-sizing: border-box; }
    button { padding: 6px 12px; margin-top: 5px; cursor: pointer; }
    .output { margin-top: 10px; white-space: pre-wrap; background: #f9f9f9; padding: 10px; border-radius: 4px; }
    .missed { background: #ffe6e6; }
    .section { margin-bottom: 30px; }
    label { display: inline-block; margin-right: 10px; }
  </style>
</head>
<body>
  <h1>Feedback Tool</h1>

  <!-- Раздел 1: Вопросы и баллы -->
  <div class="section">
    <h2>Вопросы и баллы</h2>
    <table id="questionsTable">
      <thead>
        <tr>
          <th>#</th>
          <th>Вопрос</th>
          <th>Макс. балл</th>
        </tr>
      </thead>
      <tbody>
        <!-- Здесь JS вставит строки -->
      </tbody>
    </table>

    <label>Баллы (C34): <input type="number" id="totalScore" min="0" max="69" value="0"></label>
    <button onclick="computeMissed()">Обновить пропущенные</button>
    <div id="missedList" class="output">Ничего не пропущено</div>
  </div>

  <!-- Раздел 2: Расчёт итоговой оценки -->
  <div class="section">
    <h2>Балловая оценка</h2>
    <div>Процент: <span id="percentScore">0%</span></div>
    <div>Оценка без выполнения по и/о: <span id="scoreNoTarget">0</span></div>
    <div>С выполненной целью по т/о: <span id="scoreWithTarget">0</span></div>
  </div>

  <!-- Раздел 3: Время обслуживания -->
  <div class="section">
    <h2>Время обслуживания</h2>
    <button onclick="generateTimes()">Сгенерировать время</button>
    <div id="timesOutput" class="output"></div>
  </div>

  <!-- Раздел 4: Обратная связь -->
  <div class="section">
    <h2>Обратная связь</h2>
    <label>Имя тестируемого: <input type="text" id="userName" placeholder="Имя"></label>
    <button onclick="generateFeedback()">Сгенерировать обратную связь</button>
    <div id="feedbackOutput" class="output"></div>
  </div>

<script>
  // === Массив вопросов с максимальными баллами ===
  const questions = [
    { q:1,  text: "Лидер участка готовится к смене, заполняет чек-лист подготовки к смене? Собирает и анализирует информацию (цели, результаты, тенденции продаж, пиковые часы, новые программы и акции, отзывы гостей, заметки собрания Руководителей департаментов)?", max:3 },
    { q:2,  text: "Проверяет расписание и убеждается в наличии необходимого количества сотрудников (N/S, больничные листы, комплектация позиций в пиковые часы, обучение на смене)?", max:3 },
    { q:3,  text: "Убеждается, что имеется необходимый запас продуктов на участке (24 ч—упаковка, 2 ч—продукты), все текущие наименования меню продаются? Проверяет, что участок «Обслуживание» организован в соответствии с принципами эргономии и оптимальной организации?", max:2 },
    { q:4,  text: "Проверяет правильную работу и настройку оборудования, выполнение заданий ПТО, необходимое количество мелкого инвентаря на каждой станции, график включения и выключения оборудования?", max:2 },
    { q:5,  text: "Знает цели лидера смены, ставит цели на смену, которые поддерживают выполнение целей лидера смены и направлены на устранение корневой причины проблемы ПБО и работу с мероприятиями к задаче из Плана действий ПБО? Доводит цели на смену до всех работников участка «Обслуживание»?", max:2 },
    { q:6,  text: "Проверяет, что все доступные для гостей опции сервиса и реклама в рабочем состоянии (мобильный заказ, киоски самообслуживания, мониторы ORV, пин-пады, сканеры, локаторы, COD, аудиосистема, рекламные носители и др.), организация витрины Кидз Комбо?", max:1 },
    { q:7,  text: "Первичные и вторичные сроки хранения продуктов соблюдаются, продукты промаркированы?", max:3 },
    { q:8,  text: "Мойка рук происходит с соблюдением соответствующих процедур и в соответствующее время? Выполняются правила личной гигиены? Сотрудники с симптомами заболеваний не допускаются к работе?", max:2 },
    { q:9,  text: "Соблюдаются процедуры использования перчаток, сеточек для волос, СИЗ согласно действующим рекомендациям? Санитарная одежда (фартуки, халаты) используется в соответствии с инструкцией?", max:1 },
    { q:10, text: "Готовая продукция соответствует Золотым Стандартам Качества?", max:3 },
    { q:11, text: "Лидер участка проводит оценку внешнего вида картофеля, напитков и десертов, продукции Кафе в течение смены и оценку качества: несколько палочек картофеля-фри – 2-3 раза в смену, Двойной Эспрессо – с каждой работающей кофемашины утром при открытии ПБО? Способен распознавать расхождения во Вкусе и Качестве продукции и правильно использует Алгоритм решения проблем?", max:2 },
    { q:12, text: "Лидер участка наблюдает, знает и заранее определяет потенциальные опасные зоны, отслеживает барьеры в обслуживании, используя видимые ориентиры, и предпринимает действия для их устранения согласно Алгоритму решения проблем при возникновении опасной зоны? Для помощи выбирает правильную позицию, своевременно включается в процесс (Step in) и выходит из него (Step out)?", max:3 },
    { q:13, text: "Работники на участке «Обслуживание» расставлены в соответствии с прогнозами по количеству гостей и выполняют вторичные обязанности? Расстановка работников по VLH соблюдается в течение всей смены? Лидер участка осуществляет контроль трудозатрат (выход/уход/перерывы) в течение всей смены?", max:5 },
    { q:14, text: "Лидер участка своевременно готовится к пиковым часам? Все станции укомплектованы по системе 24/2, соблюдаются принципы оптимальной организации?", max:3 },
    { q:15, text: "Продукция готовится по заказу гостя по соответствующим мониторам (eProduction картофель, мониторы напитков и десертов, монитор Кафе)? Заказы правильно удаляются со всех мониторов?", max:2 },
    { q:16, text: "Лидер участка и работники участка Обслуживание соблюдают принципы сбора заказов (сборщик никогда не останавливается, информация в нужное время в нужном месте, достаточно пространства)? Экспедитор находится на позиции, когда это необходимо по VLH?", max:3 },
    { q:17, text: "Работники соблюдают процедуры сброса заказов с мониторов (экспо-монитор, презентер, мини-ORB, монитор Автозаказа/онлайн-Экспресс)?", max:3 },
    { q:18, text: "Работники правильно выполняют процедуры приёма заказа и продажи с подсказкой и уточнениями, следуя принципу «Выгодный Комбо или 1+1»? Работники владеют информацией по меню, маркетинговым программам, программам лояльности, готовы помочь гостям?", max:3 },
    { q:19, text: "Заказы без бургеров собирают «вне очереди», правильно работают с невостребованными заказами?", max:2 },
    { q:20, text: "Лидер участка и работники участка Обслуживание общаются с гостями вежливо, внимательно и искренне (улыбка, контакт глазами, дружелюбный тон), проявляют индивидуальный подход, обеспечивая исключительный опыт посещения, выполняют 4 шага возврата гостей?", max:2 },
    { q:21, text: "Процедуры на станциях выполняются правильно, контролируется качество продуктов на каждом этапе, сроки хранения готового продукта соблюдаются? Лидер участка своевременно удаляет невостребованную продукцию со стола ОАТ и тележки для напитков?", max:2 },
    { q:22, text: "Лидер участка демонстрирует на личном примере модели поведения для улучшения опыта гостей, включая решение жалоб; знает, как действовать при проблемах мобильного приложения?", max:2 },
    { q:23, text: "Точность: гости получают правильно собранные заказы, порции правильного размера, соусы, салфетки, приборы; при 2+ жалобах на неточность баллы не начисляются?", max:5 },
    { q:24, text: "Вопрос 24 (всегда 0 баллов)", max:0 },
    { q:25, text: "Обслуживание за столами: выдача собранных продуктов и напитков аккуратно, вежливо; фартуки надеты; перед отходом убеждаются, что у гостей есть все приборы и салфетки?", max:1 },
    { q:26, text: "Доставка: соблюдаются процедуры пробития, сбора, упаковки, прокатки статусов, выдачи курьерам; комплектация при ≥10 заказах в час переносится от стола ОАТ?", max:1 },
    { q:27, text: "Контролирует и обеспечивает стандарты внешнего вида всех работников?", max:1 },
    { q:28, text: "Контролирует принцип «Чисти по ходу работы»; зоны обслуживания и видимые гостям участки чистые?", max:1 },
    { q:29, text: "Является наставником: даёт развивающую обратную связь, составляет КЛН, наделяет полномочиями, мотивирует работников, проводит небольшие соревнования?", max:1 },
    { q:30, text: "В течение смены лидер анализирует скорость обслуживания и отзывы гостей, доводит итоги до работников, предпринимает действия для улучшения?", max:1 },
    { q:31, text: "Лидер знает и выполняет план по сокращению потерь, ведёт учёт отходов сырой и готовой продукции?", max:1 },
    { q:32, text: "Лидер анализирует результаты смены, отмечает достижения, благодарит работников за смену?", max:1 }
  ];

  // === Место для ваших 60 шаблонов ===
  const feedbackTemplates = [
    /* Пример:
    { good: 1, bad: 4, text: "Подготовка к смене организована чётко, чек-лист заполнен вовремя. Уделите больше внимания проверке наличия мелкого инвентаря на каждой станции." },
    { good: 2, bad: 2, text: "Расписание и комплектация персонала на уровне, все позиции закрыты. Усильте контроль за больничными и заменами в экстренных ситуациях." },
    // ... и т.д. (всего 60) ...
    */
  ];

  // Заполняем таблицу вопросов
  const tbody = document.querySelector('#questionsTable tbody');
  questions.forEach(q => {
    const row = tbody.insertRow();
    row.insertCell().textContent = q.q;
    row.insertCell().textContent = q.text;
    row.insertCell().textContent = q.max;
  });

  // Функция подсчёта пропущенных вопросов
  function computeMissed() {
    const score = parseInt(document.getElementById('totalScore').value) || 0;
    let missing = 69 - score - 2; // вычитаем 2 балла за пункт 24
    const missed = [];
    tbody.querySelectorAll('tr').forEach(row => row.classList.remove('missed'));

    if (missing > 0) {
      let avail = questions.filter(x => x.max > 0 && x.q !== 24);

      if (missing >= 5) {
        const crit = avail.find(x => x.max === 5);
        if (crit) {
          missed.push(crit.q);
          missing -= 5;
          avail = avail.filter(x => x.q !== crit.q);
        }
      }

      while (missing > 0 && avail.length) {
        const idx = Math.floor(Math.random() * avail.length);
        const item = avail[idx];
        if (item.max <= missing) {
          missed.push(item.q);
          missing -= item.max;
        }
        avail.splice(idx, 1);
      }

      missed.forEach(n => {
        tbody.rows[n - 1].classList.add('missed');
      });
    }

    document.getElementById('missedList').textContent = missed.length
      ? "Пропущены: " + missed.join(', ')
      : "Ничего не пропущено";
    updateScores();
    window._missed = missed;
  }

  // Обновление оценок
  document.getElementById('totalScore').addEventListener('change', computeMissed);
  function updateScores() {
    const score = parseInt(document.getElementById('totalScore').value) || 0;
    const pct = ((score / 69) * 100).toFixed(2) + "%";
    document.getElementById('percentScore').textContent = pct;

    const noTargetVal = ((score / 69) * 100 * 0.9).toFixed(2);
    document.getElementById('scoreNoTarget').textContent = noTargetVal;

    const withTargetVal = (parseFloat(noTargetVal) + 10).toFixed(2);
    document.getElementById('scoreWithTarget').textContent = withTargetVal;
  }

  // Генерация случайных времен
  function generateTimes() {
    const ranges = [
      [80, 100, 20],
      [120, 200, 60],
      [200, 300, 20]
    ];
    const F = [], G = [];

    for (let i = 0; i < 8; i++) {
      [F, G].forEach(arr => {
        const r = Math.random() * 100;
        let range = ranges.find(rng => r <= rng[2] || (rng[2] === 60 && r > 20));
        if (!range) range = ranges[1];
        let v = Math.floor(Math.random() * (range[1] - range[0] + 1) + range[0]);
        if (v % 10 === 0) v += Math.floor(Math.random() * 7) - 3;
        arr.push(v);
      });
    }

    // Вычисляем средние значения
    const avgF = (F.reduce((a, b) => a + b, 0) / F.length).toFixed(2);
    const avgG = (G.reduce((a, b) => a + b, 0) / G.length).toFixed(2);

    // Отображаем
    document.getElementById('timesOutput').textContent =
      "Прилавок (F): " + F.join(', ') + "  — Среднее: " + avgF + "\n" +
      "Окно Экспресс (G): " + G.join(', ') + "  — Среднее: " + avgG;

    window._times = { F, G };
  }

  // Генерация обратной связи
  function generateFeedback() {
    const name = document.getElementById('userName').value || 'Тестируемый';
    const missed = window._missed || [];
    const correct = questions.map(q => q.q).filter(n => n !== 24 && !missed.includes(n));

    // Фильтруем только те шаблоны, где good ∈ correct, bad ∈ missed
    const cands = feedbackTemplates.filter(t =>
      correct.includes(t.good) && missed.includes(t.bad)
    );

    let out;
    if (cands.length > 0) {
      const pick = cands[Math.floor(Math.random() * cands.length)];
      out = pick.text.replace('{Name}', name);
    } else {
      out = "Нет подходящего шаблона обратной связи.";
    }

    document.getElementById('feedbackOutput').textContent = out;
  }
</script>
</body>
</html>
